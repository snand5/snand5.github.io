---
layout: default
---
<article class="post">
  <header class="post-header" role="region" aria-label="Post header">
    <h1 class="post-title">{{ page.title }}</h1>
    {% if page.subtitle %}
    <h3 class="subtitle">{{ page.subtitle }}</h3>
    {% endif %}
    <div class="byline">
      <a href="/writing.html">
        <div class="avatar">
          <img src="/assets/images/avatar.jpeg" alt="{{ page.author }} avatar">
        </div>
      </a>
      <div class="author-meta">
        <a href="/writing.html" style="text-decoration: none;"><span
            class="author-name">{{ page.author }}</span></a>
        <time class="post-date" datetime="{{ page.date | date_to_xmlschema }}">
          {{ page.date | date: "%-d %B, %Y" }}
        </time>
      </div>
    </div>
  </header>
  {%- if page.image -%}
  <figure class="in-text-image bordered">
    <img src="{{ page.image | relative_url }}"
      width="1456" height="819"
      alt="{{ page.alt }}"
      loading="lazy"
      class="clickable-image sizing-normal">
    <div class="view-image-btn">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
        viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-maximize2 lucide-maximize-2">
        <polyline points="15 3 21 3 21 9"></polyline>
        <polyline points="9 21 3 21 3 15"></polyline>
        <line x1="21" x2="14" y1="3" y2="10"></line>
        <line x1="3" x2="10" y1="21" y2="14"></line>
      </svg>
    </div>
    {% if page.caption %}
    <figcaption>{{ page.caption }}</figcaption>
    {% endif %}
  </figure>
  {%- endif -%}

  <div class="available-content">
    <div class="article-content">
      {{ content }}
    </div>
  </div>
</article>
<script src="/assets/js/image-gallery.js"></script>
<script>
  (function() {
  console.log('Footnote script loaded');
 
  function groupFootnotes() {
    console.log('groupFootnotes running');
   
    const allSups = document.querySelectorAll('sup[role="doc-noteref"]');
    console.log('Found sups:', allSups.length);
   
    if (allSups.length === 0) {
      console.log('No sups found, exiting');
      return;
    }
   
    const processed = new Set();
   
    allSups.forEach((sup, index) => {
      if (processed.has(sup)) return;
     
      // Check if this sup is already within brackets
      let prevNode = sup.previousSibling;
      let foundOpenBracket = false;
      
      // Look backwards through siblings to see if we're already in a bracket group
      while (prevNode) {
        if (prevNode.nodeType === 3) { // Text node
          const text = prevNode.textContent.trim();
          if (text.endsWith('[')) {
            foundOpenBracket = true;
            break;
          }
          if (text && !text.match(/^[,\s]*$/)) {
            // Found other text, not in a bracket group
            break;
          }
        } else if (prevNode.tagName === 'SUP') {
          // Keep looking back
        } else {
          break;
        }
        prevNode = prevNode.previousSibling;
      }
      
      // If already in brackets, skip
      if (foundOpenBracket) {
        processed.add(sup);
        return;
      }
      
      const group = [sup];
      processed.add(sup);
     
      // Look ahead for consecutive sups (with possible commas/spaces between)
      let nextNode = sup.nextSibling;
      while (nextNode) {
        if (nextNode.nodeType === 3) { // Text node
          const text = nextNode.textContent;
          if (text.match(/^[,\s]+$/)) {
            // Just whitespace/commas, keep going
            nextNode = nextNode.nextSibling;
            continue;
          } else if (text.includes(']')) {
            // Found closing bracket, stop
            break;
          } else {
            // Other text, stop looking
            break;
          }
        } else if (nextNode.nodeType === 1 && nextNode.tagName === 'SUP') {
          group.push(nextNode);
          processed.add(nextNode);
          nextNode = nextNode.nextSibling;
        } else {
          break;
        }
      }
     
      console.log('Group ' + index + ' has ' + group.length + ' items');
     
      // Add opening bracket
      const openBracket = document.createTextNode('[');
      group[0].parentNode.insertBefore(openBracket, group[0]);
     
      // Add commas between items (only if not already there)
      for (let i = 0; i < group.length - 1; i++) {
        const nextSibling = group[i].nextSibling;
        let needsComma = true;
        
        if (nextSibling && nextSibling.nodeType === 3) {
          const text = nextSibling.textContent;
          if (text.match(/^[,\s]/)) {
            needsComma = false;
          }
        }
        
        if (needsComma) {
          const comma = document.createTextNode(', ');
          group[i].parentNode.insertBefore(comma, group[i].nextSibling);
        }
      }
     
      // Add closing bracket
      const closeBracket = document.createTextNode(']');
      const lastSup = group[group.length - 1];
      lastSup.parentNode.insertBefore(closeBracket, lastSup.nextSibling);
    });
   
    console.log('Finished processing');
  }
 
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', groupFootnotes);
  } else {
    groupFootnotes();
  }
})();
</script>